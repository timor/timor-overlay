From 3f7c89d6edd334d384f1286dd44f4e7fdfd9cb03 Mon Sep 17 00:00:00 2001
From: timor <timor.dd@googlemail.com>
Date: Fri, 19 Mar 2021 17:52:47 +0100
Subject: [PATCH] index on fix-g-free: 806f364 gatotray 3.3 with memory chart

---
 settings.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/settings.c b/settings.c
index 7eb0e30..7e84c95 100644
--- a/settings.c
+++ b/settings.c
@@ -144,9 +144,12 @@ void pref_init()
     for(PrefString* s=pref_strings; s < pref_strings+G_N_ELEMENTS(pref_strings); s++)
     {
         GError* gerror = NULL;
-        *s->value = s->default_value;
+        *s->value = g_strdup(s->default_value);
         gchar* value = g_key_file_get_string(pref_file, "Options", s->description, &gerror);
-        if(!gerror) *s->value = value;
+        if(!gerror) {
+          g_free(*s->value);
+          *s->value = value;
+        }
     }
     preferences_changed();
 }
-- 
2.25.4

